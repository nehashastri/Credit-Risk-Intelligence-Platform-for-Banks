# airflow/.astro/config.yaml
mounts:
  - source: airflow/include/service_account.json
    target: /usr/local/airflow/include/service_account.json

project:
  name: airflow

deploy:
  include:
    - "dags/**/*.py"
    - "include/config/**"
    - "include/service_account.json"

# âœ… global env block so Airflow picks them up
env:
  - AIRFLOW__WEBSERVER__BASE_URL=https://8080-cs-839183587140-default.cs-us-east1-dogs.cloudshell.dev
  - AIRFLOW__WEBSERVER__WEB_SERVER_ALLOWED_HOSTS=8080-cs-839183587140-default.cs-us-east1-dogs.cloudshell.dev,localhost,127.0.0.1
  - AIRFLOW__WEBSERVER__ENABLE_PROXY_FIX=True
  - AIRFLOW__WEBSERVER__COOKIE_SECURE=False
  - AIRFLOW__WEBSERVER__COOKIE_SAMESITE=Lax
  - AIRFLOW__WEBSERVER__AUTHENTICATE=False
  - AIRFLOW__WEBSERVER__EXPOSE_CONFIG=True
  - AIRFLOW__CORE__FERNET_KEY=astronomer_dev_key

services:
  ui:
    command: ui
    ports:
      - 8080:8080
  api:
    command: api
    ports:
      - 8081:8080
  scheduler:
    command: scheduler
  triggerer:
    command: triggerer
  dag-processor:
    command: dag-processor
  postgres:
    image: postgres:12
    ports:
      - 5432:5432
